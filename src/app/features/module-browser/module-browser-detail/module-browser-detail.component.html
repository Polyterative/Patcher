<ng-container *ngIf="{
data:(dataService.singleModuleData$|async),
racksWithThisModule:(dataService.racksWithThisModule$|async),
patchesWithThisModule:(dataService.patchesWithThisModule$|async),
modulesBySameManufacturer:(dataService.modulesBySameManufacturer$|async)
} as bag"
>
  <div class="col gap1"
  >
    <lib-hero-content-card class="modulesBG"
                           titleBig="Module details"
    >
      <div fxLayout.gt-md="row" fxLayout="column" fxLayoutGap="2rem"
      >
        <lib-screen-wrapper maxSize="36rem"
        >
          <div class="col gap2">
            <lib-clean-card>
              
              <lib-auto-content-loading-indicator *ngIf="bag.data==null;else data"
                                                  [loadingLines]="5"
                                                  [skipFirstData]="true"
              >
              </lib-auto-content-loading-indicator>
              
              
              <ng-template #data>
                <app-module-composite [data]="(bag.data)"
                                      [viewConfig]="viewConfig"
                                      style="margin: 10rem"
                ></app-module-composite>
              </ng-template>
            
            </lib-clean-card>
            
            <div class="rowwrap gap1" *ngIf="bag.data">
              <ng-container *ngFor="let link of searchLinks">
                <a [href]="link.url(bag.data.name, bag.data.manufacturer.name)"
                   rel="noopener noreferrer" target="_blank" [attr.aria-label]="'Search on ' + link.label">
                  <button mat-flat-button [matTooltip]="link.tooltip">
                    <mat-icon *ngIf="link.icon">{{ link.icon }}</mat-icon>
                    <span>{{ link.label }}</span>
                  </button>
                </a>
              </ng-container>
            </div>
          </div>
        
        </lib-screen-wrapper>
        
        <div fxFlex class="col gap2"
          >
            <lib-hero-content-card *ngIf="bag.data&&dataService.moduleEditingPanelOpenState$|async"
                                   titleNormal="Module Editor"
            >
              <app-module-editor [data]="(bag.data)"
              ></app-module-editor>
            </lib-hero-content-card>
            
            <div fxLayout.gt-md="row"
                 fxLayout="column"
                 fxLayoutGap="1rem"
            >
              <lib-hero-content-card *ngIf="viewConfig.hideRackedIn===false"
                                     style="flex: 1 1 100%;"
                                     titleNormal="Racked in"
              >
                <lib-auto-content-loading-indicator [data$]="dataService.racksWithThisModule$"
                                                    [updateData$]="dataService.updateSingleModuleData$"
                >
                  <app-module-racks
                    *ngIf="(bag.racksWithThisModule)&&(bag.racksWithThisModule).length>0; else noRacks"
                    [data$]="dataService.racksWithThisModule$"
                  ></app-module-racks>
                </lib-auto-content-loading-indicator>
              </lib-hero-content-card>
              <lib-hero-content-card *ngIf="viewConfig.hidePatchedIn===false"
                                     style="flex: 1 1 100%;"
                                     titleNormal="Patched in"
              >
                
                
                <lib-auto-content-loading-indicator [data$]="dataService.patchesWithThisModule$"
                                                    [updateData$]="dataService.updateSingleModuleData$"
                >
                  <app-module-patches
                    *ngIf="(bag.patchesWithThisModule)&&(bag.patchesWithThisModule).length>0; else noPatches"
                    [data$]="dataService.patchesWithThisModule$"
                  ></app-module-patches>
                </lib-auto-content-loading-indicator>
              </lib-hero-content-card>
            </div>
            
            <lib-hero-content-card *ngIf="bag.data?.manufacturer&&viewConfig.hideBySameManufacturer===false"
                                   [titleNormal]="'Others by *'+(bag.data.manufacturer.name) + '*'"
                                   fxFlex
            >
              
              
              <lib-auto-content-loading-indicator [data$]="dataService.modulesBySameManufacturer$"
                                                  [updateData$]="dataService.updateSingleModuleData$"
              >
                <app-module-list
                  *ngIf="(bag.modulesBySameManufacturer)&&(bag.modulesBySameManufacturer).length>0; else noModulesWithSameManufacturer"
                  [data$]="dataService.modulesBySameManufacturer$"
                  [viewConfig]="bySameManufacturerViewConfig"
                ></app-module-list>
              </lib-auto-content-loading-indicator>
            </lib-hero-content-card>
          </div>
      
      </div>
    </lib-hero-content-card>
  </div>
</ng-container>

<ng-template #noRacks>
  <div class="col gap1 animate-fadein-slowest"
  >
    <mat-card-subtitle fxLayoutAlign="center start"
                       style="padding: 1rem"
    >No racks using this module yet. Try adding it to yours!
    </mat-card-subtitle>
  </div>
</ng-template>
<ng-template #noPatches>
  <div class="col gap1 animate-fadein-slowest"
  >
    <mat-card-subtitle fxLayoutAlign="center start"
                       style="padding: 1rem"
    >No patches using this module yet. Try adding it to yours!
    </mat-card-subtitle>
  </div>
</ng-template>

<ng-template #noModulesWithSameManufacturer>
  <div class="col gap1 animate-fadein-slowest"
  >
    <mat-card-subtitle fxLayoutAlign="center start"
                       style="padding: 1rem"
    >No more modules by this manufacturer yet.
    </mat-card-subtitle>
  </div>
</ng-template>