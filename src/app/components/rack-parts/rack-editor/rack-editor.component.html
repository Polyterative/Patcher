<ng-container *ngIf="{
  rackModules:(rackModules$|async),
  isCurrentRackPropertyOfCurrentUser:(dataService.isCurrentRackPropertyOfCurrentUser$|async),
  isCurrentRackEditable:(dataService.isCurrentRackEditable$|async)
  } as bag"
>
  <div class="col gap1"
  >
    <lib-hero-content-card *ngIf="bag.rackModules.length>0; else noData"
                           [description]="bag.rackModules.length+' module(s) in rack'+' /' +
                            ' '+data.hp+' HP per row'+' / ' +
                             ''+(bag.rackModules|totalHpOfModules)+' used HP' +
                             ((bag.isCurrentRackPropertyOfCurrentUser&&bag.isCurrentRackEditable)?'/ Changes saving automatically':'/ Unlock to make changes')"
                           style="transition: background 500ms cubic-bezier(0, 0, 0.2, 1);"
                           [ngClass]="{'editiableBG':bag.isCurrentRackPropertyOfCurrentUser&&bag.isCurrentRackEditable, 'readOnlyBG':(bag.isCurrentRackPropertyOfCurrentUser&&(!bag.isCurrentRackEditable))}"
    >
      <div class="col gap1"
           style="overflow-x: auto;"
  
      >
        <lib-screen-wrapper [maxSize]="data.hp+'rem'">
          <div class="col gap1"
          >
            <mat-card-subtitle [ngStyle]="{width: data.hp+'rem'}"
                               fxLayoutAlign="center center"
                               class="widthRuler"
            >{{data.hp}}</mat-card-subtitle>
        
            <div class="row"
                 fxLayoutGap=".1rem"
                 cdkDropList
                 cdkDropListOrientation="horizontal"
                 (cdkDropListDropped)="dataService.rackOrderChange$.next($event)"
            >
              <ng-container *ngIf="bag.rackModules">
  
                <ng-container *ngFor="let item of bag.rackModules">
                  <app-module-realistic [data]="item"
                                        cdkDrag
                                        [cdkDragDisabled]="!bag.isCurrentRackEditable"
                  ></app-module-realistic>
  
                </ng-container>
                <div [fxFlex]="(data.hp - (bag.rackModules|totalHpOfModules))+'rem'">
                  <app-rack-details-remaining-indicator [data]="data"
                                                        [rackModules$]="rackModules$"
                                                        fxFlex="fill"
                  ></app-rack-details-remaining-indicator>
                </div>

              </ng-container>
            </div>
            <div fxFlex="auto"></div>
          </div>
        </lib-screen-wrapper>
      </div>
    </lib-hero-content-card>
  
  </div>
  <ng-template #noData>
    <div fxFlex="auto">
      <div class="col gap1 animate-fadein-slowest"
      >
        <mat-card-subtitle fxLayoutAlign="center start"
                           style="padding: 1rem"
        >No modules in rack yet
        </mat-card-subtitle>
      </div>
    </div>
  </ng-template>
</ng-container>