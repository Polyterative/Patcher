<ng-container *ngIf="{
  rowedRackedModules:((dataService.rowedRackedModules$|async)),
  isCurrentRackPropertyOfCurrentUser:(dataService.isCurrentRackPropertyOfCurrentUser$|async),
  isCurrentRackEditable:(dataService.isCurrentRackEditable$|async),
  userRequestedSmallerScale:(dataService.userRequestedSmallerScale$|async)
  } as bag"
>
  <div class="col gap1"
  >
    <lib-auto-content-loading-indicator *ngIf="bag.rowedRackedModules==null;else yesdata"
                                        [skipFirstData]="true"
                                        [loadingLines]="5"
    >
    </lib-auto-content-loading-indicator>
  </div>
  
  <ng-template #yesdata>
    <lib-hero-content-card [description]="(bag.rowedRackedModules|totalModulesOfRack)+' module(s) '+' /' +
                            ' '+data.hp+' HP per row'+' / ' +
                             ''+(bag.rowedRackedModules|totalHpOfRack)+' HP used' +
                             (bag.isCurrentRackPropertyOfCurrentUser?(((bag.isCurrentRackPropertyOfCurrentUser&&bag.isCurrentRackEditable)?' / Changes saved automatically / Right click on modules for more options / Add modules from below':' / Unlock to make changes')):'')"
                           descriptionAlign="alignTextEnd"
                           class="transition-all-long"
                           [ngClass]="{
                           'editiableBG':bag.isCurrentRackPropertyOfCurrentUser&&bag.isCurrentRackEditable, 
                           'readOnlyBG':(bag.isCurrentRackPropertyOfCurrentUser&&(!bag.isCurrentRackEditable))
                           }"
    
    >
      <div class="col gap1 transition-all scroll custom-scrollbar"
           [ngClass]="{'rackLocked':!(bag.isCurrentRackPropertyOfCurrentUser&&bag.isCurrentRackEditable)}"
      
      >
        <lib-screen-wrapper [maxSize]="data.hp+'rem'"
        
        >
          <div class="col gap1"
          
          >
            <div class="row gap1">
              <mat-slide-toggle [checked]="dataService.shouldShowPanelImages$|async"
                                (change)="dataService.shouldShowPanelImages$.next(!dataService.shouldShowPanelImages$.value)"
              >
                Show panels as images
              </mat-slide-toggle>
              <mat-slide-toggle [checked]="dataService.userRequestedSmallerScale$|async"
                                (change)="dataService.userRequestedSmallerScale$.next(!dataService.userRequestedSmallerScale$.value)"
              >
                I've got many modules
              </mat-slide-toggle>
              
              <!--              create space between these-->
              <div fxFlex="1 1 auto"></div>
              <app-brand-primary-button
                (click)="dataService.updateRackImage$.next()"
              >
                Update preview
              </app-brand-primary-button>
              <app-brand-primary-button
                (click)="dataService.downloadRackImageToUserComputer$.next()"
              >
                Download as image
              </app-brand-primary-button>
            </div>
            
            
            <app-rack-visual-model [rackData]="data"
                                   [rowedRackedModules]="bag.rowedRackedModules"
                                   [isCurrentRackPropertyOfCurrentUser]="bag.isCurrentRackPropertyOfCurrentUser"
                                   [isCurrentRackEditable]="bag.isCurrentRackEditable"
                                   [rackDetailDataService]="dataService"
                                   [moduleRightClick$]="moduleRightClick$"
                                   class="transition-all-long"
                                   [ngClass]="{
                                     'smallerScale':bag.userRequestedSmallerScale
                                   }"
            ></app-rack-visual-model>
          </div>
        </lib-screen-wrapper>
      </div>
    </lib-hero-content-card>
    <app-general-context-menu></app-general-context-menu>
  </ng-template>
  <ng-template #noData>
    <div fxFlex="100">
      <div class="col gap1 animate-fadein-slowest"
      >
        <mat-card-subtitle fxLayoutAlign="center start"
                           style="padding: 1rem"
        >No modules in rack yet
        </mat-card-subtitle>
      </div>
    </div>
  </ng-template>

</ng-container>


<div id="download">
  <img #canvas>
  <a #download></a>
</div>